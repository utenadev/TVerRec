# TVerRec Go移植 実装計画

## フェーズ1: プロジェクト基盤とコア機能 (優先度: 高)

### 1.1 プロジェクト初期化
- [ ] Go modulesプロジェクトの作成
- [ ] ディレクトリ構造の設計・作成
- [ ] 依存関係管理 (go.mod/go.sum)
- [ ] CI/CDパイプライン設定 (GitHub Actions)
- [ ] クロスコンパイル設定 (Windows/Linux/macOS)

### 1.2 設定管理システム
- [ ] 設定構造体の定義 (config.go)
- [ ] YAML設定ファイル形式への移行
- [ ] 設定ファイル読み込み・検証機能
- [ ] デフォルト設定とユーザー設定のマージ機能
- [ ] 設定ファイル自動生成機能

### 1.3 ログ・エラーハンドリング
- [ ] 構造化ログシステム (logrus/zap)
- [ ] エラーハンドリング戦略の実装
- [ ] デバッグモード対応
- [ ] ログローテーション機能

### 1.4 ファイル・ディレクトリ管理
- [ ] パス管理ユーティリティ
- [ ] ディスク容量チェック機能
- [ ] ファイルロック機能
- [ ] 一時ファイル管理

## フェーズ2: TVerAPI連携とデータ処理 (優先度: 高)

### 2.1 HTTP クライアント
- [ ] TVerAPI用HTTPクライアント実装
- [ ] 日本IP取得・設定機能
- [ ] プロキシ対応
- [ ] レート制限・リトライ機能
- [ ] タイムアウト設定

### 2.2 TVerAPI機能
- [ ] トークン取得機能 (Get-Token相当)
- [ ] 番組検索機能 (Get-VideoLinksFromKeyword相当)
- [ ] 番組情報取得 (Get-VideoInfo相当)
- [ ] キーワード・タグ・シリーズ検索
- [ ] マイページ連携機能

### 2.3 データモデル
- [ ] 番組情報構造体定義
- [ ] キーワード管理構造体
- [ ] ダウンロード履歴構造体
- [ ] 無視リスト構造体
- [ ] JSON/CSV シリアライゼーション

### 2.4 データベース・ストレージ
- [ ] SQLite組み込みDB対応
- [ ] CSV互換性維持
- [ ] データマイグレーション機能
- [ ] バックアップ・復元機能

## フェーズ3: ダウンロード・メディア処理 (優先度: 高)

### 3.1 外部プロセス管理
- [ ] yt-dlp実行ラッパー
- [ ] FFmpeg実行ラッパー
- [ ] プロセス並列実行管理
- [ ] プロセス監視・制御
- [ ] 外部ツール自動更新機能

### 3.2 ダウンロード機能
- [ ] 並列ダウンロード制御
- [ ] ダウンロード進捗管理
- [ ] 失敗時リトライ機能
- [ ] 一時停止・再開機能
- [ ] ダウンロード履歴管理

### 3.3 ファイル処理
- [ ] 動画ファイル検証機能
- [ ] ファイル名整形・リネーム
- [ ] メタデータ埋め込み
- [ ] 字幕処理
- [ ] ファイル移動・整理

### 3.4 品質管理
- [ ] 動画整合性チェック
- [ ] 破損ファイル検出・削除
- [ ] 重複ファイル検出
- [ ] ストレージ最適化

## フェーズ4: スケジューラ・常駐機能 (優先度: 中)

### 4.1 スケジューラ
- [ ] 定期実行スケジューラ
- [ ] cron式スケジュール対応
- [ ] 実行時間制御
- [ ] スケジュール停止機能

### 4.2 常駐サービス
- [ ] デーモン・サービス化
- [ ] プロセス管理 (開始・停止・再起動)
- [ ] ヘルスチェック機能
- [ ] 自動復旧機能

### 4.3 監視・通知
- [ ] システム監視機能
- [ ] Discord通知 (utenadev/discat)
- [ ] アラート機能
- [ ] 統計情報収集

## フェーズ5: CLI インターフェース (優先度: 中)

### 5.1 CLI インターフェース
- [ ] コマンドライン引数解析 (cobra)
- [ ] サブコマンド実装
- [ ] 進捗表示・プログレスバー
- [ ] インタラクティブモード
- [ ] 設定ファイル生成コマンド
- [ ] ステータス表示コマンド

### 5.2 通知システム
- [ ] Discord通知 (utenadev/discat)
- [ ] 通知設定管理
- [ ] 通知テンプレート
- [ ] エラー通知・完了通知

## フェーズ6: 互換性・移行支援 (優先度: 低)

### 6.1 PowerShell版互換性
- [ ] 設定ファイル移行ツール
- [ ] データベース移行ツール
- [ ] 動作比較テスト
- [ ] 移行ガイド作成

### 6.2 拡張機能
- [ ] プラグインシステム
- [ ] カスタムフィルター
- [ ] 外部連携API
- [ ] 設定テンプレート

## フェーズ7: テスト・品質保証 (全フェーズ並行)

### 7.1 単体テスト
- [ ] コア機能のテストカバレッジ 80%以上
- [ ] API連携テスト (モック使用)
- [ ] ファイル処理テスト
- [ ] 設定管理テスト

### 7.2 統合テスト
- [ ] エンドツーエンドテスト
- [ ] パフォーマンステスト
- [ ] 負荷テスト
- [ ] 長時間実行テスト

### 7.3 互換性テスト
- [ ] 複数OS対応テスト
- [ ] 既存データ移行テスト
- [ ] PowerShell版との動作比較
- [ ] 外部ツール連携テスト

## 技術選定

### コア技術
- **言語**: Go 1.21+
- **設定**: YAML (gopkg.in/yaml.v3)
- **CLI**: Cobra (github.com/spf13/cobra)
- **HTTP**: 標準net/http + カスタムクライアント
- **ログ**: logrus (github.com/sirupsen/logrus)
- **DB**: SQLite (github.com/mattn/go-sqlite3)

### オプション技術
- **通知**: utenadev/discat (Discord通知)
- **テスト**: testify (github.com/stretchr/testify)
- **ビルド**: GoReleaser (github.com/goreleaser/goreleaser)
- **進捗表示**: progressbar (github.com/schollz/progressbar)

## 実装優先順位

1. **最優先 (MVP)**: フェーズ1-3 (コア機能・API・ダウンロード)
2. **高優先**: フェーズ4 (スケジューラ・常駐)
3. **中優先**: フェーズ5 (CLI・通知)
4. **低優先**: フェーズ6 (互換性・拡張)

## 成功指標

- [ ] PowerShell版と同等の機能を提供
- [ ] パフォーマンス: 20%以上の高速化
- [ ] メモリ使用量: 30%以上の削減
- [ ] バイナリサイズ: 50MB以下
- [ ] 起動時間: 3秒以内
- [ ] 既存ユーザーの移行率: 80%以上

## リスク・課題

### 技術的リスク
- TVerAPI仕様変更への対応
- 外部ツール(yt-dlp/FFmpeg)の互換性
- クロスプラットフォーム対応の複雑さ

### 対策
- API変更監視・自動テスト
- 外部ツールバージョン管理
- CI/CDでの複数OS自動テスト

### 移行リスク
- 既存ユーザーの学習コスト
- 設定・データ移行の複雑さ
- 機能差分による不満

### 対策
- 段階的移行サポート
- 詳細な移行ガイド
- PowerShell版との並行運用期間