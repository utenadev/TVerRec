# 要件文書

## 概要

TVerRecは、テレビ番組配信サイトTVerの番組をダウンロード・保存するためのツールです。キーワード指定による一括ダウンロードや、新しい番組が配信される度に自動でダウンロードする常駐監視機能を持ちます。

## 要件

### 要件 1: キーワードによる一括ダウンロード

**ユーザーストーリー:** ユーザーとして、好きな番組のジャンルや出演者、番組名をキーワードとして設定したいので、関連する番組が配信された際に自動でダウンロードできる。

#### 受入基準

1. WHEN ユーザーが `conf/keyword.conf` にキーワード（例：ドラマ、特定の俳優名）を記述する THEN システムはそのキーワードに合致するTVer上の番組を検索する SHALL
2. WHEN `a.download_bulk.cmd` または `a.download_bulk.sh` が実行される THEN システムは検索した番組リストに基づき、まだダウンロードされていない番組をダウンロードする SHALL
3. WHEN ダウンロードが完了する THEN システムはダウンロード履歴を `db/history.csv` に記録し、同じ番組の重複ダウンロードを防ぐ SHALL

### 要件 2: 定期的な自動ダウンロード（常駐監視）

**ユーザーストーリー:** ユーザーとして、一度起動すればツールがバックグラウンドで動作し続けてほしいので、新しい番組が配信される度に手動で操作することなく自動でダウンロードできる。

#### 受入基準

1. WHEN ユーザーが `start_tverrec.cmd` または `start_tverrec.sh` を実行する THEN システムは定期的にキーワードに基づく番組検索とダウンロードを繰り返すループ処理を開始する SHALL
2. WHEN `stop_tverrec.cmd` または `stop_tverrec.sh` が実行される THEN システムはループ処理を安全に停止する SHALL
3. WHEN ループ処理が実行中 THEN システムは指定された間隔（設定可能）で新しい番組を確認する SHALL

### 要件 3: GUIによる操作（Windows限定）

**ユーザーストーリー:** Windowsユーザーとして、コマンドラインに不慣れでも直感的に操作したいので、グラフィカルな設定画面や実行ボタンがほしい。

#### 受入基準

1. WHEN ユーザーが `TVerRec.cmd` を実行する THEN システムはメインのGUIウィンドウを表示する SHALL
2. WHEN ユーザーがGUI上の「設定」ボタンをクリックする THEN システムは `Setting.cmd` を実行し、設定用のGUIウィンドウを表示する SHALL
3. WHEN GUIウィンドウが表示される THEN ユーザーはダウンロードの実行、停止、設定の変更などの主要な操作をボタンクリックで行える SHALL

### 要件 4: 依存関係の自動管理

**ユーザーストーリー:** ユーザーとして、複雑なセットアップ作業をしたくないので、動作に必要なソフトウェア（PowerShell Core, youtube-dl, ffmpeg）が自動でインストール・更新されてほしい。

#### 受入基準

1. WHEN ユーザーがWindowsで `*.cmd` ファイルを初めて実行し、PowerShell Coreがインストールされていない THEN システムは`winget`を使用してPowerShell Coreの自動インストールを試みる SHALL
2. WHEN いずれかのダウンロード処理が実行される THEN システムは `youtube-dl` と `ffmpeg` の最新版が存在するか確認し、なければ自動でダウンロードする SHALL
3. WHEN ユーザーが `update_tverrec.cmd` を実行する THEN システムはTVerRec自体を最新の安定版に更新する SHALL

### 要件 5: クロスプラットフォーム対応

**ユーザーストーリー:** ユーザーとして、WindowsだけでなくMacやLinuxでもこのツールを使いたいので、主要なOSで同じ機能が利用できる。

#### 受入基準

1. WHEN ユーザーがWindows環境にいる THEN `win` ディレクトリ内の `.cmd` ファイルを実行して各機能を利用できる SHALL
2. WHEN ユーザーがLinuxまたはmacOS環境にいる THEN `unix` ディレクトリ内の `.sh` ファイルを実行して各機能を利用できる SHALL
3. WHEN いずれのOSで実行しても THEN ダウンロードやファイル管理などのコア機能は `src` ディレクトリ内のPowerShellスクリプトによって共通のロジックで実行される SHALL

### 要件 6: ダウンロードファイルの品質管理

**ユーザーストーリー:** ユーザーとして、ダウンロードした動画が正常に再生できるか不安なので、ファイルが破損していないかチェックする機能がほしい。

#### 受入基準

1. WHEN ユーザーが `c.validate_video.cmd` または `c.validate_video.sh` を実行する THEN システムはダウンロード済みの動画ファイルの破損チェックを行う SHALL
2. WHEN 破損したファイルが検出される THEN システムはそのファイルに関する情報をログに出力する SHALL
3. WHEN ダウンロード処理が完了した後 THEN オプションで自動的に整合性チェックを実行するように設定できる SHALL
